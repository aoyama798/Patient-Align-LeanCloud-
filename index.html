<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>病人管理系统</title>

<style>
/* ===== style.css 内容 ===== */
body {
  font-family: "Tahoma", sans-serif;
  margin:0;
  padding:0;
  background:#f4f6f8;
}

header {
  display:flex;
  justify-content: space-between;
  align-items:center;
  padding: 1rem;
  background:#2196F3;
  color:#fff;
}

.input-area {
  display:flex;
  gap: 0.5rem;
  padding: 1rem;
}

.board {
  display:flex;
  overflow-x:auto;
  padding: 1rem;
}

.doctor-column {
  background:#fff;
  margin:0.5rem;
  padding:0.5rem;
  border-radius:8px;
  min-width:200px;
  flex-shrink:0;
}

.doctor-column h2 {
  text-align:center;
}

.patient-card {
  background:#e3f2fd;
  margin:0.5rem 0;
  padding:0.5rem;
  border-radius:6px;
  cursor:grab;
}

.patient-card.recent {
  border:2px solid red;
}

.operation-area {
  display:flex;
  gap:1rem;
  padding:1rem;
}

.drop-zone {
  flex:1;
  height:80px;
  background:#eee;
  border:2px dashed #ccc;
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:8px;
}

.modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}

.modal-content {
  background:#fff;
  padding:1rem;
  border-radius:8px;
  max-width:400px;
  width:90%;
  display:flex;
  flex-direction:column;
  gap:0.5rem;
}

textarea {
  resize:none;
}

@media (max-width:1024px) {
  .board { flex-wrap:wrap; }
  .doctor-column { flex: 1 1 45%; }
}

@media (max-width:600px) {
  .doctor-column { flex: 1 1 100%; }
}
</style>

</head>
<body>

<header>
  <h1>病人管理系统</h1>
  <div class="view-toggle">
    <button id="currentPatientsBtn">当前在院</button>
    <button id="allPatientsBtn">所有病人</button>
  </div>
</header>

<section class="input-area">
  <input type="text" id="patientName" placeholder="输入病人姓名">
  <select id="doctorSelect"></select>
  <button id="addPatientBtn">新增病人</button>
</section>

<section class="board">
  <div class="doctor-columns" id="doctorColumns"></div>
</section>

<section class="operation-area">
  <div class="drop-zone" id="dischargeZone">出院</div>
  <div class="drop-zone" id="deleteZone">删除</div>
</section>

<!-- 模态框 -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3 id="modalTitle">编辑信息</h3>
    <input type="text" id="modalInput" placeholder="">
    <textarea id="modalNotes" placeholder="备注/代办事项"></textarea>
    <div class="modal-buttons">
      <button id="modalConfirm">确认</button>
      <button id="modalCancel">取消</button>
    </div>
  </div>
</div>

<!-- LeanCloud SDK -->
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.10.0/dist/av-min.js"></script>

<script>
/* ===== app.js 内容 ===== */

// 初始化 LeanCloud
AV.init({
  appId: "aMqT7BEEzEAg4xdPE7YrniuN-gzGzoHsz",
  appKey: "hWHxbIukqYqAVGJh839mj32y"
});

let patients = [];
let doctors = [];
let doctorOrder = [];
let recentPatientName = "";

// DOM
const doctorColumns = document.getElementById("doctorColumns");
const doctorSelect = document.getElementById("doctorSelect");
const patientNameInput = document.getElementById("patientName");
const addPatientBtn = document.getElementById("addPatientBtn");

const editModal = document.getElementById("editModal");
const modalInput = document.getElementById("modalInput");
const modalNotes = document.getElementById("modalNotes");
const modalConfirm = document.getElementById("modalConfirm");
const modalCancel = document.getElementById("modalCancel");

let currentEdit = null;

// 新增病人
addPatientBtn.addEventListener("click", () => {
  const name = patientNameInput.value.trim();
  const doctor = doctorSelect.value;
  if(!name || !doctor) return alert("请输入完整信息");
  const patient = { name, doctor, notes:"", discharged:false, id:Date.now() };
  patients.push(patient);
  recentPatientName = name;
  renderBoard();
  saveData();
  patientNameInput.value = "";
});

// 渲染医生列和病人卡片
function renderBoard(){
  doctorColumns.innerHTML = "";
  doctorOrder.forEach(doc => {
    const col = document.createElement("div");
    col.className = "doctor-column";
    const h2 = document.createElement("h2");
    h2.textContent = doc;
    col.appendChild(h2);
    
    patients.filter(p=>p.doctor===doc).forEach(p=>{
      const card = document.createElement("div");
      card.className = "patient-card";
      if(p.name===recentPatientName) card.classList.add("recent");
      card.textContent = p.name;
      card.draggable = true;
      card.addEventListener("dblclick", ()=>openEditModal(p));
      col.appendChild(card);
    });
    
    doctorColumns.appendChild(col);
  });
}

// 模态框
function openEditModal(patient){
  currentEdit = patient;
  modalInput.value = patient.name;
  modalNotes.value = patient.notes;
  editModal.style.display = "flex";
}

modalConfirm.addEventListener("click", ()=>{
  if(currentEdit){
    currentEdit.name = modalInput.value.trim();
    currentEdit.notes = modalNotes.value;
    renderBoard();
    saveData();
    editModal.style.display = "none";
  }
});
modalCancel.addEventListener("click", ()=>{ editModal.style.display = "none"; });

// 数据保存
function saveData(){
  console.log("保存到 LeanCloud (此处可实现云端保存)");
}

// 初始加载
function loadData(){
  doctorOrder = ["张医生","李医生","王医生"];
  doctors = [...doctorOrder];
  doctors.forEach(d=>{
    const option = document.createElement("option");
    option.value = d;
    option.textContent = d;
    doctorSelect.appendChild(option);
  });
  renderBoard();
}

loadData();
</script>

</body>
</html>
